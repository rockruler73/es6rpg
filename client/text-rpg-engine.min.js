!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("text-rpg-engine.js",[],t):"object"==typeof exports?exports["text-rpg-engine.js"]=t():e["text-rpg-engine.js"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=t}var t,n,r;return t=e,(n=[{key:"addItems",value:function(e){return this.items=this.items.concat(e),this.items}},{key:"dropItem",value:function(e){var t=this.items.filter(function(t){return t.name!==e});return this.items=t,this.items}}])&&o(t.prototype,n),r&&o(t,r),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new(((o=n(2))&&o.__esModule?o:{default:o}).default);t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=u(n(3)),r=u(n(4)),i=u(n(5)),a=u(n(6)),s=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:""),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.Display=new o.default,this.Input=new r.default,this.datapath=t,this.rooms=n,this.startRoom=a,this.endRoom=s,this.Player=new i.default(a=this.startRoom)}var t,n,u;return t=e,(n=[{key:"init",value:function(){var e;console.log("Initialized game from: "+this.datapath),this.loadData(this.datapath),""===this.startRoom&&this.rooms.length>0&&(this.startRoom=this.rooms[0].name,this.Player.startRoom=this.startRoom,this.Player.currentRoom=this.Player.startRoom),""===this.endRoom&&this.rooms.length>0&&(this.endRoom=this.rooms[this.rooms.length-1].name);for(var t=0;t<this.rooms.length;t++)if(this.rooms[t].name===this.startRoom){e=this.rooms[t].getText;break}void 0===e&&(e="No starting room text found"),this.Display.show(e)}},{key:"addRoom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=new a.default(e,t,n,o);return this.rooms.push(r),r}},{key:"dropRoom",value:function(e){var t=this.rooms.filter(function(t){return t.name!==e});return this.rooms=t,this.rooms}},{key:"getRoom",value:function(e){return this.rooms.find(function(t){return t.name===e})}},{key:"decidePath",value:function(e){"restart"===e&&this.resetGame();var t=this,n=t.getRoom(t.Player.currentRoom);if(void 0!==f(n.prompts)){var o=!1;n.prompts.forEach(function(n){if(!1===o){var r=n.matchKeywords(e,t.Player.inventory.items);if(null!==r){if(o=!0,"success"in r&&(t.Display.show("<p>".concat(r.success.successText,"</p>")),void 0!==r.success.itemsGiven&&t.Player.inventory.addItems(r.success.itemsGiven),void 0!==r.success.roomToEnter)){var i,a,s=l(t.Player.enterRoom(t.getRoom(r.success.roomToEnter)),2);a=s[0],i=s[1],t.Display.append("<p>".concat(a,"</p>")),i&&r.success.roomToEnter===t.endRoom&&t.win()}if("fail"in r)return t.Display.show("".concat(r.fail.failText)),void t.Display.append("<p>Missing required items: ".concat(r.fail.missing.toString(),".\n              </p><p>").concat(t.getRoom(t.Player.currentRoom).getText,"</p>"))}}!1===o&&t.Display.show('<p>No actions could be done from: "'.concat(e,"\". Try something else, or be more \n          specific about what you're doing.</p><p>").concat(t.getRoom(t.Player.currentRoom).getText,"</p>"))})}else t.Display.show("<p>There doesn't seem to be any actions at all that you can do in this room.</p>\n      ".concat(t.getRoom(t.Player.currentRoom).getText));console.log(e,this.Player)}},{key:"userSend",value:function(e){this.Input.send(e),this.decidePath(this.Input.value)}},{key:"disableInput",value:function(){this.Input.disable()}},{key:"enableInput",value:function(){this.Input.enable()}},{key:"win",value:function(){this.Display.append("<p>YOU WIN!</p>"),this.disableInput()}},{key:"resetGame",value:function(){this.Player.inventory=new s.default,this.Player.currentRoom=this.startRoom;var e=this.getRoom(this.startRoom);this.Display.show(e.getText),this.Input.enable()}},{key:"loadData",value:function(e){fetch(e).then(function(e){return e.json()}).then(function(e){console.log(e)})}}])&&c(t.prototype,n),u&&c(t,u),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"display";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.html=t,this.elementId=n}var t,n,r;return t=e,(n=[{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?document.getElementById(this.elementId).innerHTML=this.html:(document.getElementById(this.elementId).innerHTML=e,this.html=e)}},{key:"append",value:function(e){document.getElementById(this.elementId).innerHtml+=e}}])&&o(t.prototype,n),r&&o(t,r),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"input";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.disabled=t,this.value=n,this.elementId=o}var t,n,r;return t=e,(n=[{key:"enable",value:function(){this.disabled=!1,document.getElementById("input").disabled=!1}},{key:"disable",value:function(){this.disabled=!0,document.getElementById("input").disabled=!0}},{key:"send",value:function(e){e=e.toLowerCase(),this.value=e}}])&&o(t.prototype,n),r&&o(t,r),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,r=(o=n(0))&&o.__esModule?o:{default:o};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.default,o=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments[3]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,""===this.name&&(this.name="player"),this.inventory=n,""===this.currentRoom&&(this.currentRoom=this.startRoom),this.startRoom=o}var t,n,o;return t=e,(n=[{key:"enterRoom",value:function(e){var t=e.enter(this.inventory.items);return!1===t[1]||(this.currentRoom=e.name),[t[0],t[1]]}},{key:"getItem",value:function(e){return this.inventory.addItem(e),this.inventory}},{key:"dropItem",value:function(e){return this.inventory.dropItem(e),this.inventory}}])&&i(t.prototype,n),o&&i(t,o),e}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,r=(o=n(7))&&o.__esModule?o:{default:o};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.getText=n,this.requirements=o,this.prompts=r}var t,n,o;return t=e,(n=[{key:"addPrompt",value:function(e,t,n,o){var i=new r.default(e,t,n,o);return this.prompts.push(i),this.prompts}},{key:"enter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="",n=!0;return this.requirements>0?0===e.length?(n=!1,this.requirements.forEach(function(e){t+="".concat(e.failText,". ")})):(this.requirements.forEach(function(e){var o=!1;this.items.forEach(function(t){t===e&&(o=!0)}),!1===o&&(n=!1,t+=e.failText)}),!0===n&&(t=this.getText)):t=this.getText,[t,n]}}])&&i(t.prototype,n),o&&i(t,o),e}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.keywords=n.map(function(e){return e.toLowerCase()}),this.results=o,this.requirements=r}var t,n,r;return t=e,(n=[{key:"matchKeywords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!1,o=[];return this.requirements.length>0&&this.requirements.forEach(function(e){var n=!1;t.forEach(function(t){t===e&&(n=!0)}),n||o.push(e)}),this.keywords.forEach(function(t){e.includes(t.toLowerCase())&&(n=!0)}),n?o.length>0?{fail:{missing:o,failText:this.results.failText}}:{success:this.results}:null}}])&&o(t.prototype,n),r&&o(t,r),e}();t.default=r,e.exports=t.default}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL3RleHQtcnBnLWVuZ2luZS5qcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvLi9zcmMvaW52ZW50b3J5LmpzIiwid2VicGFjazovL3RleHQtcnBnLWVuZ2luZS5qcy8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvLi9zcmMvZGlzcGxheS5qcyIsIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvLi9zcmMvaW5wdXQuanMiLCJ3ZWJwYWNrOi8vdGV4dC1ycGctZW5naW5lLmpzLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvLi9zcmMvcm9vbS5qcyIsIndlYnBhY2s6Ly90ZXh0LXJwZy1lbmdpbmUuanMvLi9zcmMvcHJvbXB0LmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkludmVudG9yeSIsIml0ZW1zIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiX2NsYXNzQ2FsbENoZWNrIiwiY29uY2F0IiwiaXRlbU5hbWUiLCJuZXdJbnZlbnRvcnkiLCJmaWx0ZXIiLCJpdGVtIiwiZGVmYXVsdCIsIl9kaXNwbGF5IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9pbnB1dCIsIl9wbGF5ZXIiLCJfcm9vbSIsIl9pbnZlbnRvcnkiLCJHYW1lIiwiZGF0YXBhdGgiLCJyb29tcyIsInN0YXJ0Um9vbSIsImVuZFJvb20iLCJEaXNwbGF5IiwiSW5wdXQiLCJQbGF5ZXIiLCJkaXNwbGF5VGV4dCIsImNvbnNvbGUiLCJsb2ciLCJsb2FkRGF0YSIsImN1cnJlbnRSb29tIiwiZ2V0VGV4dCIsInNob3ciLCJwcm9tcHRzIiwicmVxdWlyZW1lbnRzIiwicm9vbU9iaiIsInB1c2giLCJyb29tTmFtZSIsIm5ld1Jvb21zIiwicm9vbSIsImZpbmQiLCJ4IiwibWVzc2FnZSIsInJlc2V0R2FtZSIsIl90aGlzIiwiY3VyclJvb20iLCJnZXRSb29tIiwiX3R5cGVvZiIsImZvdW5kUHJvbXB0IiwiZm9yRWFjaCIsInByb21wdCIsIm1hdGNoaW5nUHJvbXB0UmVzdWx0cyIsIm1hdGNoS2V5d29yZHMiLCJpbnZlbnRvcnkiLCJzdWNjZXNzIiwic3VjY2Vzc1RleHQiLCJpdGVtc0dpdmVuIiwiYWRkSXRlbXMiLCJyb29tVG9FbnRlciIsImVudGVyUm9vbVJlc3VsdFN1Y2Nlc3MiLCJlbnRlclJvb21SZXN1bHRUZXh0IiwiX3RoaXMkUGxheWVyJGVudGVyUm9vMiIsIl9zbGljZWRUb0FycmF5IiwiZW50ZXJSb29tIiwiYXBwZW5kIiwid2luIiwiZmFpbCIsImZhaWxUZXh0IiwibWlzc2luZyIsInRvU3RyaW5nIiwic2VuZCIsImRlY2lkZVBhdGgiLCJkaXNhYmxlIiwiZW5hYmxlIiwiZGlzYWJsZUlucHV0IiwiZmlsZXBhdGgiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJqc29uIiwiZGF0YSIsImh0bWwiLCJlbGVtZW50SWQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiaW5uZXJIdG1sIiwiZGlzYWJsZWQiLCJ0b0xvd2VyQ2FzZSIsInJvb21SZXN1bHQiLCJlbnRlciIsImFkZEl0ZW0iLCJkcm9wSXRlbSIsIl9wcm9tcHQiLCJSb29tIiwia2V5d29yZHMiLCJyZXN1bHRzIiwicmVzdWx0VGV4dCIsIm1ldEFsbFJlcXVpcmVtZW50cyIsInJlcXVpcmVtZW50IiwiZm91bmQiLCJQcm9tcHQiLCJtYXAiLCJ2IiwiZm91bmRLZXl3b3JkIiwibWlzc2luZ1JlcXVpcmVtZW50cyIsImZvdW5kUmVxdWlyZW1lbnQiLCJrZXl3b3JkIiwiaW5jbHVkZXMiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsaUJBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELElBQ0EsbUJBQUFHLGVBQUFDLElBQ0FELE9BQUEsd0JBQUFILEdBQ0EsaUJBQUFDLFFBQ0FBLFFBQUEsc0JBQUFELElBRUFELEVBQUEsc0JBQUFDLElBUkEsQ0FTQyxvQkFBQUssVUFBQUMsS0FBQSxXQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVIsUUFHQSxJQUFBQyxFQUFBSyxFQUFBRSxHQUFBLENBQ0FDLEVBQUFELEVBQ0FFLEdBQUEsRUFDQVYsUUFBQSxJQVVBLE9BTkFXLEVBQUFILEdBQUFJLEtBQUFYLEVBQUFELFFBQUFDLElBQUFELFFBQUFPLEdBR0FOLEVBQUFTLEdBQUEsRUFHQVQsRUFBQUQsUUEwREEsT0FyREFPLEVBQUFNLEVBQUFGLEVBR0FKLEVBQUFPLEVBQUFSLEVBR0FDLEVBQUFRLEVBQUEsU0FBQWYsRUFBQWdCLEVBQUFDLEdBQ0FWLEVBQUFXLEVBQUFsQixFQUFBZ0IsSUFDQUcsT0FBQUMsZUFBQXBCLEVBQUFnQixFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDVixFQUFBZ0IsRUFB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LEdBQ3pCc0csR0FBZSxFQUNmQyxFQUFzQixHQTJCMUIsT0F4Qkk3SSxLQUFLc0UsYUFBYS9CLE9BQVMsR0FFN0J2QyxLQUFLc0UsYUFBYWUsUUFBUSxTQUFVa0QsR0FDbEMsSUFBSU8sR0FBbUIsRUFFdkJ6RyxFQUFNZ0QsUUFBUSxTQUFVdkMsR0FDbEJBLElBQVN5RixJQUNYTyxHQUFtQixLQUlsQkEsR0FDSEQsRUFBb0JyRSxLQUFLK0QsS0FNL0J2SSxLQUFLbUksU0FBUzlDLFFBQVEsU0FBVTBELEdBQzFCakUsRUFBUWtFLFNBQVNELEVBQVFuQixpQkFDM0JnQixHQUFlLEtBSWZBLEVBRUVDLEVBQW9CdEcsT0FBUyxFQUV4QixDQUFDK0QsS0FBUSxDQUNkRSxRQUFXcUMsRUFDWHRDLFNBQVl2RyxLQUFLb0ksUUFBUTdCLFdBSXRCLENBQUNiLFFBQVcxRixLQUFLb0ksU0FFbkIiLCJmaWxlIjoidGV4dC1ycGctZW5naW5lLmpzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwidGV4dC1ycGctZW5naW5lLmpzXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcInRleHQtcnBnLWVuZ2luZS5qc1wiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJ0ZXh0LXJwZy1lbmdpbmUuanNcIl0gPSBmYWN0b3J5KCk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW52ZW50b3J5IHtcclxuICAvLyBjb25zdHJ1Y3RvclxyXG4gIGNvbnN0cnVjdG9yKGl0ZW1zID0gW10pIHtcclxuICAgIHRoaXMuaXRlbXMgPSBpdGVtcztcclxuICB9XHJcblxyXG4gIC8vIGNhbiBhZGQgc2luZ2xlIG9yIG11bHRpcGxlIGl0ZW1zOyBwYXJhbWV0ZXIgcGFzc2VkIGluIHNob3VsZCBiZSBhbiBhcnJheVxyXG4gIGFkZEl0ZW1zKGl0ZW1zKSB7XHJcbiAgICB0aGlzLml0ZW1zID0gdGhpcy5pdGVtcy5jb25jYXQoaXRlbXMpO1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXM7XHJcbiAgfVxyXG5cclxuICAvLyBkcm9wIGFuIGl0ZW0gYnkgZmlsdGVyaW5nIG91dCB0aGUgaXRlbSBuYW1lIHRoYXQgd2Ugd2FudCB0byBkcm9wIGFuZCByZXR1cm5pbmcgdGhlIGludmVudG9yeSB3aXRob3V0IGl0XHJcbiAgZHJvcEl0ZW0oaXRlbU5hbWUpIHtcclxuICAgIGxldCBuZXdJbnZlbnRvcnkgPSB0aGlzLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICByZXR1cm4gaXRlbS5uYW1lICE9PSBpdGVtTmFtZTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuaXRlbXMgPSBuZXdJbnZlbnRvcnk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXM7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBHYW1lIGZyb20gJy4vZ2FtZSc7XHJcblxyXG5jb25zdCBnYW1lID0gbmV3IEdhbWUoKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGdhbWU7XHJcbiIsIi8qXHJcbmdhbWUuanNcclxuaW1wb3J0cyBhbmQgbWFuYWdlcyB0aGUgcGllY2VzIHdlIGJ1aWxkIHRvIG1ha2Ugb25lIGNvaGVzaXZlIGdhbWUhIFlheSFcclxuICovXHJcbi8vIGltcG9ydHMgLSB0aGVzZSBpbnN0YW50aWF0ZSB0aGUgaW1wb3J0cyBhbmQgc3RvcmUgdGhlbSBhcyBwcm9wZXJ0aWVzIHNvIHdlIGNhbiByZWZlcmVuY2UgdGhlaXIgcHJvcGVydGllcyBpbiBnYW1lLmpzXHJcbmltcG9ydCBEaXNwbGF5IGZyb20gJy4vZGlzcGxheSc7XHJcbmltcG9ydCBJbnB1dCBmcm9tICcuL2lucHV0JztcclxuaW1wb3J0IFBsYXllciBmcm9tICcuL3BsYXllcic7XHJcbmltcG9ydCBSb29tIGZyb20gJy4vcm9vbSc7XHJcbmltcG9ydCBJbnZlbnRvcnkgZnJvbSAnLi9pbnZlbnRvcnknO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XHJcbiAgLy8gY29uc3RydWN0b3JcclxuICBjb25zdHJ1Y3RvcihkYXRhcGF0aCA9ICcnLCByb29tcyA9IFtdLCBpdGVtcyA9IFtdLCBzdGFydFJvb20gPSAnJywgZW5kUm9vbSA9ICcnKSB7XHJcbiAgICB0aGlzLkRpc3BsYXkgPSBuZXcgRGlzcGxheSgpO1xyXG4gICAgdGhpcy5JbnB1dCA9IG5ldyBJbnB1dCgpO1xyXG4gICAgdGhpcy5kYXRhcGF0aCA9IGRhdGFwYXRoO1xyXG4gICAgLy8gZGF0YXBhdGggaXMgZm9yIGFuIGFkZGVkIGNoYWxsZW5nZSwgSSBjYW4gbG9hZCBpbiBhIEpTT04gZmlsZSB3aXRoIGEgZ2FtZSBidWlsdCBpbnRvIGl0IDopIGNoZWNrIGluaXQgZm9yIG1vcmVcclxuICAgIHRoaXMucm9vbXMgPSByb29tczsgLy8gYWxsIHJvb21zIGluIGdhbWVcclxuICAgIHRoaXMuc3RhcnRSb29tID0gc3RhcnRSb29tOyAvLyByb29tIHRoZSBwbGF5ZXIgd2lsbCBzdGFydCBpblxyXG4gICAgdGhpcy5lbmRSb29tID0gZW5kUm9vbTsgLy8gd2hpY2ggcm9vbSBpcyB0aGUgZ2FtZS1lbmQgcm9vbVxyXG4gICAgdGhpcy5QbGF5ZXIgPSBuZXcgUGxheWVyKHN0YXJ0Um9vbSA9IHRoaXMuc3RhcnRSb29tKTtcclxuICB9XHJcblxyXG4gIC8vIEluaXRpYWxpemVzIHRoZSBnYW1lXHJcbiAgaW5pdCgpIHtcclxuICAgIGxldCBkaXNwbGF5VGV4dDtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnSW5pdGlhbGl6ZWQgZ2FtZSBmcm9tOiAnICsgdGhpcy5kYXRhcGF0aCk7XHJcbiAgICB0aGlzLmxvYWREYXRhKHRoaXMuZGF0YXBhdGgpOyAvLyBUT0RPOiBtYWtlIGdhbWVzIGxvYWQgZnJvbSBqc29uIGRhdGFcclxuICAgIC8vIGlmIGdhbWUgd2Fzbid0IGluaXRhbGl6ZWQgd2l0aCBzdGFydFJvb20sIHNldCBpdCB0byB0aGUgZmlyc3Qgcm9vbVxyXG4gICAgaWYgKHRoaXMuc3RhcnRSb29tID09PSAnJyAmJiB0aGlzLnJvb21zLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5zdGFydFJvb20gPSB0aGlzLnJvb21zWzBdLm5hbWU7XHJcbiAgICAgIHRoaXMuUGxheWVyLnN0YXJ0Um9vbSA9IHRoaXMuc3RhcnRSb29tO1xyXG4gICAgICB0aGlzLlBsYXllci5jdXJyZW50Um9vbSA9IHRoaXMuUGxheWVyLnN0YXJ0Um9vbTtcclxuICAgIH1cclxuICAgIC8vIGlmIGdhbWUgd2Fzbid0IGluaXRhbGl6ZWQgd2l0aCBlbmRSb29tLCBzZXQgaXQgdG8gdGhlIGZpcnN0IHJvb21cclxuICAgIGlmICh0aGlzLmVuZFJvb20gPT09ICcnICYmIHRoaXMucm9vbXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmVuZFJvb20gPSB0aGlzLnJvb21zW3RoaXMucm9vbXMubGVuZ3RoIC0gMV0ubmFtZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkaXNwbGF5IHRoZSBzdGFydFJvb20gdGV4dFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJvb21zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGlmICh0aGlzLnJvb21zW2ldLm5hbWUgPT09IHRoaXMuc3RhcnRSb29tKSB7XHJcbiAgICAgICAgZGlzcGxheVRleHQgPSB0aGlzLnJvb21zW2ldLmdldFRleHQ7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGlzcGxheVRleHQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBkaXNwbGF5VGV4dCA9ICdObyBzdGFydGluZyByb29tIHRleHQgZm91bmQnO1xyXG4gICAgfVxyXG4gICAgdGhpcy5EaXNwbGF5LnNob3coZGlzcGxheVRleHQpO1xyXG4gIH1cclxuXHJcbiAgLy8gbWFuYWdlIHJvb21zXHJcblxyXG4gIC8vIGNyZWF0ZSBhIG5ldyBSb29tIG9iamVjdCBhbmQgcHVzaCBpdCBvbnRvIHRoZSBjdXJyZW50IHJvb21zIGxpc3RcclxuICBhZGRSb29tKG5hbWUsIGdldFRleHQsIHByb21wdHMgPSBbXSwgcmVxdWlyZW1lbnRzID0gW10pIHtcclxuICAgIGxldCByb29tT2JqID0gbmV3IFJvb20obmFtZSwgZ2V0VGV4dCwgcHJvbXB0cywgcmVxdWlyZW1lbnRzKTtcclxuXHJcbiAgICB0aGlzLnJvb21zLnB1c2gocm9vbU9iaik7XHJcbiAgICByZXR1cm4gcm9vbU9iajtcclxuICB9XHJcblxyXG4gIC8vIGZpbHRlciBvdXQgYSByb29tIGFuZCBnZXQgcmlkIG9mIGl0IGlmIHdlIGRvbid0IHdhbnQgaXQgYW55bW9yZVxyXG4gIGRyb3BSb29tKHJvb21OYW1lKSB7XHJcbiAgICBsZXQgbmV3Um9vbXMgPSB0aGlzLnJvb21zLmZpbHRlcihmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICByZXR1cm4gcm9vbS5uYW1lICE9PSByb29tTmFtZTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMucm9vbXMgPSBuZXdSb29tcztcclxuICAgIHJldHVybiB0aGlzLnJvb21zO1xyXG4gIH1cclxuXHJcbiAgLy8gcmV0dXJucyByb29tIG9iamVjdCBnaXZlbiBuYW1lXHJcbiAgZ2V0Um9vbShyb29tTmFtZSkge1xyXG4gICAgLy8geCA9PiBpcyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2lsbCByZXR1cm4gdGhlIHJvb20gd2hvc2UgbmFtZSBpcyB0aGUgc2FtZSBhcyByb29tTmFtZVxyXG4gICAgY29uc3Qgcm9vbSA9IHRoaXMucm9vbXMuZmluZCh4ID0+IHgubmFtZSA9PT0gcm9vbU5hbWUpO1xyXG5cclxuICAgIHJldHVybiByb29tO1xyXG4gIH1cclxuXHJcbiAgLy8gR2FtZSBBSVxyXG4gIGRlY2lkZVBhdGgobWVzc2FnZSkge1xyXG4gICAgaWYgKG1lc3NhZ2UgPT09ICdyZXN0YXJ0Jykge1xyXG4gICAgICB0aGlzLnJlc2V0R2FtZSgpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgX3RoaXMgPSB0aGlzO1xyXG4gICAgY29uc3QgY3VyclJvb20gPSBfdGhpcy5nZXRSb29tKF90aGlzLlBsYXllci5jdXJyZW50Um9vbSk7XHJcblxyXG4gICAgLy8gRG8gd2UgaGF2ZSBhY3Rpb25zIHRoYXQgd2UgY2FuIGRvIGluIHRoZSByb29tP1xyXG4gICAgaWYgKHR5cGVvZiBjdXJyUm9vbS5wcm9tcHRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgLy8gQ2hlY2sgZXZlcnkgcHJvbXB0IGFjdGlvbiB0byBzZWUgaWYgaXQgbWF0Y2hlcyBvdXIgaW5wdXQga2V5d29yZHNcclxuICAgICAgLy8gRm9yIG5vdyBqdXN0IGdldCB0aGUgZmlyc3QgbWF0Y2hpbmcgcHJvbXB0IGFuZCBkbyB0aGF0XHJcbiAgICAgIGxldCBmb3VuZFByb21wdCA9IGZhbHNlO1xyXG5cclxuICAgICAgY3VyclJvb20ucHJvbXB0cy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9tcHQpIHtcclxuICAgICAgICBpZiAoZm91bmRQcm9tcHQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICBjb25zdCBtYXRjaGluZ1Byb21wdFJlc3VsdHMgPSBwcm9tcHQubWF0Y2hLZXl3b3JkcyhtZXNzYWdlLCBfdGhpcy5QbGF5ZXIuaW52ZW50b3J5Lml0ZW1zKTtcclxuXHJcbiAgICAgICAgICAvLyBJZiB3ZSBnZXQgYSBtYXRjaGluZyByZXN1bHQgYmFja1xyXG4gICAgICAgICAgaWYgKG1hdGNoaW5nUHJvbXB0UmVzdWx0cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIHByb21wdCBoYXMga2V5d29yZHMgdGhhdCBtYXRjaCB0aGUgdXNlcidzIGlucHV0XHJcbiAgICAgICAgICAgIGZvdW5kUHJvbXB0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gSWYgcGxheWVyIHN1Y2NlZWRlZCBpbiBwcm9tcHQgYWN0aW9uXHJcbiAgICAgICAgICAgIGlmICgnc3VjY2VzcycgaW4gbWF0Y2hpbmdQcm9tcHRSZXN1bHRzKSB7XHJcbiAgICAgICAgICAgICAgX3RoaXMuRGlzcGxheS5zaG93KGA8cD4ke21hdGNoaW5nUHJvbXB0UmVzdWx0cy5zdWNjZXNzLnN1Y2Nlc3NUZXh0fTwvcD5gKTtcclxuICAgICAgICAgICAgICAvLyBHZXQgaXRlbXMgZnJvbSBwcm9tcHQgaWYgYW55IGFyZSByZXR1cm5lZCBhbmQgYWRkIHRoZW0gdG8gaW52ZW50b3J5XHJcbiAgICAgICAgICAgICAgaWYgKG1hdGNoaW5nUHJvbXB0UmVzdWx0cy5zdWNjZXNzLml0ZW1zR2l2ZW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuUGxheWVyLmludmVudG9yeS5hZGRJdGVtcyhtYXRjaGluZ1Byb21wdFJlc3VsdHMuc3VjY2Vzcy5pdGVtc0dpdmVuKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgLy8gSWYgdGhlIHByb21wdCBzdWNjZXNzIHJlc3VsdCBpbmNsdWRlcyBlbnRlcmluZyBhIG5ldyByb29tLi5cclxuICAgICAgICAgICAgICBpZiAobWF0Y2hpbmdQcm9tcHRSZXN1bHRzLnN1Y2Nlc3Mucm9vbVRvRW50ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGVudGVyUm9vbVJlc3VsdFN1Y2Nlc3M7XHJcbiAgICAgICAgICAgICAgICBsZXQgZW50ZXJSb29tUmVzdWx0VGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgcGxheWVyIGNhbiBzdWNjZXNzZnVsbHkgZW50ZXIgdGhlIHJvb20gKGdpdmVuIHRoZSBpbnZlbnRvcnkgLyByb29tIHJlcXVpcmVtZW50cylcclxuICAgICAgICAgICAgICAgIFtlbnRlclJvb21SZXN1bHRUZXh0LCBlbnRlclJvb21SZXN1bHRTdWNjZXNzXSA9XHJcbiAgICAgICAgICAgICAgICAgIF90aGlzLlBsYXllci5lbnRlclJvb20oX3RoaXMuZ2V0Um9vbShtYXRjaGluZ1Byb21wdFJlc3VsdHMuc3VjY2Vzcy5yb29tVG9FbnRlcikpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuRGlzcGxheS5hcHBlbmQoYDxwPiR7ZW50ZXJSb29tUmVzdWx0VGV4dH08L3A+YCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50ZXJSb29tUmVzdWx0U3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgcGxheWVyIGVudGVyZWQgd2lubmluZyByb29tXHJcbiAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGluZ1Byb21wdFJlc3VsdHMuc3VjY2Vzcy5yb29tVG9FbnRlciA9PT0gX3RoaXMuZW5kUm9vbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLndpbigpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAvLyBQbGF5ZXIgY291bGQgbm90IGVudGVyIHJvb20gKG1pc3NpbmcgcmVxdWlyZWQgaXRlbXMgaW4gaW52ZW50b3J5KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBQbGF5ZXIgZmFpbGVkIHRvIGRvIHByb21wdCAobWlzc2luZyBpdGVtIHJlcXVpcmVtZW50KVxyXG4gICAgICAgICAgICBpZiAoJ2ZhaWwnIGluIG1hdGNoaW5nUHJvbXB0UmVzdWx0cykge1xyXG4gICAgICAgICAgICAgIF90aGlzLkRpc3BsYXkuc2hvdyhgJHttYXRjaGluZ1Byb21wdFJlc3VsdHMuZmFpbC5mYWlsVGV4dH1gKTtcclxuICAgICAgICAgICAgICBfdGhpcy5EaXNwbGF5LmFwcGVuZChgPHA+TWlzc2luZyByZXF1aXJlZCBpdGVtczogJHttYXRjaGluZ1Byb21wdFJlc3VsdHMuZmFpbC5taXNzaW5nLnRvU3RyaW5nKCl9LlxyXG4gICAgICAgICAgICAgIDwvcD48cD4ke190aGlzLmdldFJvb20oX3RoaXMuUGxheWVyLmN1cnJlbnRSb29tKS5nZXRUZXh0fTwvcD5gKTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZvdW5kUHJvbXB0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgLy8gUGxheWVyIGRpZG4ndCBzYXkgYW55IGtleXdvcmRzIHRoYXQgdHJpZ2dlcmVkIGFueSBvZiB0aGUgY3VycmVudCByb29tIHByb21wdHNcclxuICAgICAgICAgIF90aGlzLkRpc3BsYXkuc2hvdyhgPHA+Tm8gYWN0aW9ucyBjb3VsZCBiZSBkb25lIGZyb206IFwiJHttZXNzYWdlfVwiLiBUcnkgc29tZXRoaW5nIGVsc2UsIG9yIGJlIG1vcmUgXHJcbiAgICAgICAgICBzcGVjaWZpYyBhYm91dCB3aGF0IHlvdSdyZSBkb2luZy48L3A+PHA+JHtfdGhpcy5nZXRSb29tKF90aGlzLlBsYXllci5jdXJyZW50Um9vbSkuZ2V0VGV4dH08L3A+YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIE5vIHByb21wdHMgZXhpc3QgZm9yIHRoZSBjdXJyZW50IHJvb21cclxuICAgICAgX3RoaXMuRGlzcGxheS5zaG93KGA8cD5UaGVyZSBkb2Vzbid0IHNlZW0gdG8gYmUgYW55IGFjdGlvbnMgYXQgYWxsIHRoYXQgeW91IGNhbiBkbyBpbiB0aGlzIHJvb20uPC9wPlxyXG4gICAgICAke190aGlzLmdldFJvb20oX3RoaXMuUGxheWVyLmN1cnJlbnRSb29tKS5nZXRUZXh0fWApO1xyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2cobWVzc2FnZSwgdGhpcy5QbGF5ZXIpO1xyXG4gIH1cclxuXHJcbiAgLy8gR3JhYiB0aGUgbWVzc2FnZSBmcm9tIHRoZSB1c2VyIGFuZCBydW4gSW5wdXQuc2VuZCBvbiBpdFxyXG4gIHVzZXJTZW5kKG1lc3NhZ2UpIHtcclxuICAgIC8vIE91ciBJbnB1dCBjbGFzcyB3aWxsIGhhbmRsZSBjbGVhbmluZyAvIG5vcm1hbGl6aW5nIHN0cmluZ3NcclxuICAgIHRoaXMuSW5wdXQuc2VuZChtZXNzYWdlKTtcclxuICAgIHRoaXMuZGVjaWRlUGF0aCh0aGlzLklucHV0LnZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8vIGp1c3QgbWFrZXMgaXQgZWFzaWVyL21vcmUgcmVhZGFibGUgdG8gZGlzYWJsZSBpbnB1dFxyXG4gIGRpc2FibGVJbnB1dCgpIHtcclxuICAgIHRoaXMuSW5wdXQuZGlzYWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8ganVzdCBtYWtlcyBpdCBlYXNpZXIvbW9yZSByZWFkYWJsZSB0byBlbmFibGUgaW5wdXRcclxuICBlbmFibGVJbnB1dCgpIHtcclxuICAgIHRoaXMuSW5wdXQuZW5hYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvLyBwbGF5ZXIgd2luc1xyXG4gIHdpbigpIHtcclxuICAgIC8vIHNob3cgd2luIHRleHRcclxuICAgIHRoaXMuRGlzcGxheS5hcHBlbmQoJzxwPllPVSBXSU4hPC9wPicpO1xyXG5cclxuICAgIC8vIGRpc2FibGUgbW9yZSBpbnB1dCBhZnRlciB3aW5uaW5nXHJcbiAgICB0aGlzLmRpc2FibGVJbnB1dCgpO1xyXG4gIH1cclxuXHJcbiAgLy8gUGxheWVyIHJlc2V0cyBnYW1lXHJcbiAgcmVzZXRHYW1lKCkge1xyXG4gICAgLy8gcmVzZXRzIHBsYXllciB3aXRoIGJsYW5rIGludmVudG9yeSBhbmQgYmFjayBpbiBzdGFydGluZyByb29tXHJcbiAgICB0aGlzLlBsYXllci5pbnZlbnRvcnkgPSBuZXcgSW52ZW50b3J5KCk7XHJcbiAgICB0aGlzLlBsYXllci5jdXJyZW50Um9vbSA9IHRoaXMuc3RhcnRSb29tO1xyXG4gICAgY29uc3Qgcm9vbSA9IHRoaXMuZ2V0Um9vbSh0aGlzLnN0YXJ0Um9vbSk7XHJcblxyXG4gICAgdGhpcy5EaXNwbGF5LnNob3cocm9vbS5nZXRUZXh0KTtcclxuICAgIHRoaXMuSW5wdXQuZW5hYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvLyBsb2FkIGZyb20ganNvbiBmaWxlXHJcbiAgbG9hZERhdGEoZmlsZXBhdGgpIHtcclxuICAgIGZldGNoKGZpbGVwYXRoKVxyXG4gICAgICAudGhlbihcclxuICAgICAgICByZXMgPT4gcmVzLmpzb24oKVxyXG4gICAgICApXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCIvKlxyXG5kaXNwbGF5LmpzXHJcblNob3dzL2FwcGVuZHMgdGV4dCB0byB0aGUgc2l0ZVxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGlzcGxheSB7XHJcbiAgLy8gY29uc3RydWN0b3JcclxuICBjb25zdHJ1Y3RvcihodG1sID0gJycsIGVsZW1lbnRJZCA9ICdkaXNwbGF5Jykge1xyXG4gICAgdGhpcy5odG1sID0gaHRtbDtcclxuICAgIHRoaXMuZWxlbWVudElkID0gZWxlbWVudElkO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICBzaG93cyBnaXZlbiBIVE1MXHJcbiAgaWYgbm8gSFRNTCBpcyBnaXZlbiwgZGlzcGxheSB0aGUgSFRNTCB0aGF0J3MgaW4gdGhpcyBvYmplY3QncyBodG1sIHByb3BlcnR5IGFscmVhZHlcclxuICBvdGhlcndpc2UsIHNldCBib3RoIHRoZSBlbGVtZW50J3MgaW5uZXIgSFRNTCBhbmQgdGhlIG9iamVjdCdzIHByb3BlcnR5IHRvIHRoZSBnaXZlbiBodG1sXHJcbiAgKi9cclxuICBzaG93KGh0bWwgPSBudWxsKSB7XHJcbiAgICBpZiAoaHRtbCA9PT0gbnVsbCkge1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmVsZW1lbnRJZCkuaW5uZXJIVE1MID0gdGhpcy5odG1sO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5lbGVtZW50SWQpLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICAgIHRoaXMuaHRtbCA9IGh0bWw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBhcHBlbmQgSFRNTCB0byBkaXNwbGF5IHNjcmVlblxyXG4gIGFwcGVuZChodG1sKSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmVsZW1lbnRJZCkuaW5uZXJIdG1sICs9IGh0bWw7XHJcbiAgfVxyXG59XHJcbiIsIi8qXHJcbmlucHV0LmpzXHJcblNob3dzIHRleHQsIGFsbG93cyBmb3IgaW5wdXRcclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIElucHV0IHtcclxuICAvLyBjb25zdHJ1Y3RvclxyXG4gIGNvbnN0cnVjdG9yKGRpc2FibGVkID0gZmFsc2UsIHZhbHVlID0gJycsIGVsZW1lbnRJZCA9ICdpbnB1dCcpIHtcclxuICAgIHRoaXMuZGlzYWJsZWQgPSBkaXNhYmxlZDtcclxuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIHRoaXMuZWxlbWVudElkID0gZWxlbWVudElkO1xyXG4gIH1cclxuXHJcbiAgLy8gZW5hYmxlcyBpbnB1dCBhbmQgZG9lcyB0aGUgc2FtZSBpbiB0aGUgSFRNTFxyXG4gIGVuYWJsZSgpIHtcclxuICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvLyBkaXNhYmxlcyBpbnB1dCBhbmQgZG9lcyB0aGUgc2FtZSBpbiB0aGUgSFRNTFxyXG4gIGRpc2FibGUoKSB7XHJcbiAgICB0aGlzLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpLmRpc2FibGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vIHNlbmRzIGNsaWVudCBpbnB1dCB0byBiZSBldmFsdWF0ZWRcclxuICBzZW5kKHZhbHVlKSB7XHJcbiAgICAvLyBub3JtYWxpemUgaW5wdXQgdmFsdWVzXHJcbiAgICB2YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBJbnZlbnRvcnkgZnJvbSAnLi9pbnZlbnRvcnknO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyIHtcclxuICAvLyBjb25zdHJ1Y3RvclxyXG4gIGNvbnN0cnVjdG9yKG5hbWUgPSAnJywgaW52ZW50b3J5ID0gbmV3IEludmVudG9yeSgpLCBjdXJyZW50Um9vbSA9ICcnLCBzdGFydFJvb20pIHtcclxuICAgIC8vIGlmIG5hbWUgaXMgZ2l2ZW4sIHNldCBpdDsgaWYgbm90LCBzZXQgbmFtZSB0byAncGxheWVyJ1xyXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIGlmICh0aGlzLm5hbWUgPT09ICcnKSB7XHJcbiAgICAgIHRoaXMubmFtZSA9ICdwbGF5ZXInO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaW52ZW50b3J5ID0gaW52ZW50b3J5O1xyXG5cclxuICAgIC8vIGlmIGN1cnJlbnRSb29tIGlzIGJsYW5rLCBzZXQgaXQgdG8gc3RhcnRSb29tXHJcbiAgICBpZiAodGhpcy5jdXJyZW50Um9vbSA9PT0gJycpIHtcclxuICAgICAgdGhpcy5jdXJyZW50Um9vbSA9IHRoaXMuc3RhcnRSb29tO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdGFydFJvb20gPSBzdGFydFJvb207XHJcbiAgfVxyXG5cclxuICAvLyBlbnRlciByb29tXHJcbiAgZW50ZXJSb29tKHJvb20pIHtcclxuICAgIC8vIGFzc2lnbnMgdGhlIHZhbHVlIG9mIHJvb20uZW50ZXIgKHBhc3MsIGZhaWwsIGV0Yy4pIHRvIHJvb21SZXN1bHQgLSB0aGF0IGxvZ2ljIGlzIGluIFJvb21cclxuICAgIGNvbnN0IHJvb21SZXN1bHQgPSByb29tLmVudGVyKHRoaXMuaW52ZW50b3J5Lml0ZW1zKTtcclxuXHJcbiAgICAvLyByb29tUmVzdWx0WzFdIGlzIHRoZSBtZXRBbGxSZXF1aXJlbWVudHMgYm9vbCBpbiByb29tLmpzOyBpZiBpdCdzIGZhbHNlLCB3ZWxsLCB5ZWFoLCBpdCdzIGZhbHNlXHJcbiAgICBpZiAocm9vbVJlc3VsdFsxXSA9PT0gZmFsc2UpIHtcclxuICAgICAgLy8gcGxheWVyIGRpZG4ndCBoYXZlIHRoZSByZXF1aXJlZCBpdGVtcyB0byBlbnRlciB0aGUgcm9vbVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gZW50ZXJlZCByb29tXHJcbiAgICAgIHRoaXMuY3VycmVudFJvb20gPSByb29tLm5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV0dXJuIHJlc3VsdHMgdGV4dCBhbmQgd2hldGhlciBvciBub3QgdGhlIHBsYXllciBzdWNjZXNzZnVsbHkgZW50ZXJlZCB0aGUgcm9vbVxyXG4gICAgcmV0dXJuIFtyb29tUmVzdWx0WzBdLCByb29tUmVzdWx0WzFdXTtcclxuICB9XHJcblxyXG4gIC8vIHRoZSBsb2dpYyBmb3IgZ2V0SXRlbSBhbmQgZHJvcEl0ZW0gaXMgaW4gaW52ZW50b3J5LmpzXHJcbiAgZ2V0SXRlbShpdGVtKSB7XHJcbiAgICB0aGlzLmludmVudG9yeS5hZGRJdGVtKGl0ZW0pO1xyXG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5O1xyXG4gIH1cclxuXHJcbiAgZHJvcEl0ZW0oaXRlbSkge1xyXG4gICAgdGhpcy5pbnZlbnRvcnkuZHJvcEl0ZW0oaXRlbSk7XHJcbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQcm9tcHQgZnJvbSAnLi9wcm9tcHQnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9vbSB7XHJcbiAgLy8gY29uc3RydWN0b3JcclxuICAvLyBhY2NlcHRzIGEgc3RyaW5nIHJvb20gbmFtZSwgc3RyaW5nIG9mIHRleHQsIGFuIGFycmF5IG9mIHJlcXMgdG8gZW50ZXIgdGhlIHJvb20sIGFuZCBhIGxpc3Qgb2YgYWNjZXB0YWJsZSBwcm9tcHRzXHJcbiAgY29uc3RydWN0b3IobmFtZSA9ICcnLCBnZXRUZXh0ID0gJycsIHJlcXVpcmVtZW50cyA9IFtdLCBwcm9tcHRzID0ge30pIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLmdldFRleHQgPSBnZXRUZXh0O1xyXG4gICAgdGhpcy5yZXF1aXJlbWVudHMgPSByZXF1aXJlbWVudHM7XHJcbiAgICB0aGlzLnByb21wdHMgPSBwcm9tcHRzO1xyXG4gIH1cclxuXHJcbiAgLy8gYWRkIGEgbmV3IHByb21wdC9pbnRlcmFjdGlvbiB0byBhIHJvb21cclxuICBhZGRQcm9tcHQobmFtZSwga2V5d29yZHMsIHJlc3VsdHMsIHJlcXVpcmVtZW50cykge1xyXG4gICAgLy8gY3JlYXRlIGEgbmV3IHByb21wdCBhbmQgYXNzaWduIGl0IHRvIHRoZSBjb25zdCBwcm9tcHRcclxuICAgIGNvbnN0IHByb21wdCA9IG5ldyBQcm9tcHQobmFtZSwga2V5d29yZHMsIHJlc3VsdHMsIHJlcXVpcmVtZW50cyk7XHJcblxyXG4gICAgLy8gcHVzaCB0aGUgcHJvbXB0IG9udG8gdGhlIHJvb20ncyBsaXN0IG9mIHByb21wdHNcclxuICAgIHRoaXMucHJvbXB0cy5wdXNoKHByb21wdCk7XHJcblxyXG4gICAgLy8gcmV0dXJuIHRoZSBuZXcgbGlzdCBvZiByb29tIHByb21wdHNcclxuICAgIHJldHVybiB0aGlzLnByb21wdHM7XHJcbiAgfVxyXG5cclxuICAvLyBlbnRlciBhIHJvb21cclxuICBlbnRlcihpdGVtcyA9IFtdKSB7XHJcbiAgICBsZXQgcmVzdWx0VGV4dCA9ICcnO1xyXG4gICAgbGV0IG1ldEFsbFJlcXVpcmVtZW50cyA9IHRydWU7IC8vIHNldCB0byB0cnVlIHVudGlsIHdlIGZpbmQgdGhhdCBpdCdzIG5vdFxyXG5cclxuICAgIC8vIFRoZSByb29tIGlzIG5vdCBhY2Nlc3NpYmxlIGJ5IGRlZmF1bHQgaWYgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIHJlcXVpcmVtZW50IChpdGVtKVxyXG4gICAgaWYgKHRoaXMucmVxdWlyZW1lbnRzID4gMCkge1xyXG4gICAgICAvLyBpZiB5b3UgZG9uJ3QgaGF2ZSBlbm91Z2ggaXRlbXMsIGRvbid0IGFsbG93IGVudHJ5IHJpZ2h0IG9mZiB0aGUgYmF0XHJcbiAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBtZXRBbGxSZXF1aXJlbWVudHMgPSBmYWxzZTtcclxuICAgICAgICAvLyBBZGQgbWlzc2luZyByZXF1aXJlbWVudCBtZXNzYWdlc1xyXG4gICAgICAgIHRoaXMucmVxdWlyZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlcXVpcmVtZW50KSB7XHJcbiAgICAgICAgICByZXN1bHRUZXh0ICs9IGAke3JlcXVpcmVtZW50LmZhaWxUZXh0fS4gYDtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBjaGVjayB0aGUgcmVxdWlyZW1lbnRzIHRvIHNlZSBpZiB5b3UndmUgZm91bmQgdGhlbSBhbGxcclxuICAgICAgICB0aGlzLnJlcXVpcmVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXF1aXJlbWVudCkge1xyXG4gICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgLy8gY2hlY2sgYWxsIHVzZXIgaXRlbXM7IGlmIGl0J3MgYSByZXF1aXJlbWVudCwgc2V0IGZvdW5kIHRvIHRydWUgZm9yIHRoYXQgaXRlbVxyXG4gICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtID09PSByZXF1aXJlbWVudCkge1xyXG4gICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgLy8gaWYgZm91bmQgaXMgZmFsc2UsIHlvdSdyZSBtaXNzaW5nIGF0IGxlYXN0IG9uZSByZXF1aXJlbWVudCAtIHNheSBzb1xyXG4gICAgICAgICAgaWYgKGZvdW5kID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICBtZXRBbGxSZXF1aXJlbWVudHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmVzdWx0VGV4dCArPSByZXF1aXJlbWVudC5mYWlsVGV4dDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gaWYgYWxsIGl0ZW1zIHdlcmUgZm91bmQsIGVudGVyIHRoZSByb29tIGFuZCBzaG93IHRoZSByb29tIHRleHRcclxuICAgICAgICBpZiAobWV0QWxsUmVxdWlyZW1lbnRzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICByZXN1bHRUZXh0ID0gdGhpcy5nZXRUZXh0O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gaWYgdGhlcmUgYXJlbid0IGFueSBpdGVtcyByZXF1aXJlZCB0byBlbnRlciB0aGUgcm9vbSwganVzdCBzaG93IHRoZSByb29tIHRleHRcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc3VsdFRleHQgPSB0aGlzLmdldFRleHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV0dXJuIHJlc3VsdCB0ZXh0LCB3aGF0ZXZlciBpdCB3b3VuZCB1cCBiZWluZ1xyXG4gICAgcmV0dXJuIFtyZXN1bHRUZXh0LCBtZXRBbGxSZXF1aXJlbWVudHNdO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQcm9tcHQge1xyXG4gIC8vIGNvbnN0cnVjdG9yXHJcbiAgY29uc3RydWN0b3IobmFtZSA9ICcnLCBrZXl3b3JkcyA9IFtdLCByZXN1bHRzID0ge30sIHJlcXVpcmVtZW50cyA9IFtdKSB7XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgLy8gS2V5d29yZHMgdGhhdCBjYW4gdHJpZ2dlciB0aGUgcHJvbXB0IChtYWtlIGFsbCBsb3dlci1jYXNlIGJ5IGRlZmF1bHQpXHJcbiAgICB0aGlzLmtleXdvcmRzID0ga2V5d29yZHMubWFwKGZ1bmN0aW9uICh2KSB7IHJldHVybiB2LnRvTG93ZXJDYXNlKCk7fSk7XHJcbiAgICAvLyBSZXN1bHRzIHRoYXQgb2NjdXIgd2hlbiB0aGlzIHByb21wdCBpcyBzdWNjZXNzZnVsbHkgdHJpZ2dlcmVkO1xyXG4gICAgLy8gdGhlIHJlc3VsdCBrZXlzIGNvbXByaXNlIG9mIOKAnHN1Y2Nlc3NUZXh04oCdIChyZXF1aXJlZCksIFwiZmFpbFRleHRcIiAob3B0aW9uYWwpLFxyXG4gICAgLy8g4oCcaXRlbXNSZXF1aXJlZOKAnSAob3B0aW9uYWwpLCBhbmQg4oCccm9vbVRvRW50ZXLigJ0gKG9wdGlvbmFsKVxyXG4gICAgdGhpcy5yZXN1bHRzID0gcmVzdWx0cztcclxuICAgIC8vIEFueSBwcmVyZXF1aXNpdGUgaXRlbXMgbmVlZGVkIHRvIGRvIHRoZSBwcm9tcHQ/XHJcbiAgICB0aGlzLnJlcXVpcmVtZW50cyA9IHJlcXVpcmVtZW50cztcclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGlmIGlucHV0IG1lc3NhZ2UgbWF0Y2hlcyBhbnkgcHJvbXB0IGtleXdvcmRzIGFuZCByZXR1cm4gcmVzdWx0c1xyXG4gIG1hdGNoS2V5d29yZHMobWVzc2FnZSwgaXRlbXMgPSBbXSkge1xyXG4gICAgbGV0IGZvdW5kS2V5d29yZCA9IGZhbHNlO1xyXG4gICAgbGV0IG1pc3NpbmdSZXF1aXJlbWVudHMgPSBbXTtcclxuXHJcbiAgICAvLyBJZiB3ZSBoYXZlIGFueSBpdGVtIHJlcXVpcmVtZW50c1xyXG4gICAgaWYgKHRoaXMucmVxdWlyZW1lbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gQ2hlY2sgYWxsIHRoZSByZXF1aXJlbWVudHMgYWdhaW5zdCB0aGUgaXRlbXMgcGFzc2VkXHJcbiAgICAgIHRoaXMucmVxdWlyZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlcXVpcmVtZW50KSB7XHJcbiAgICAgICAgbGV0IGZvdW5kUmVxdWlyZW1lbnQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgaWYgKGl0ZW0gPT09IHJlcXVpcmVtZW50KSB7XHJcbiAgICAgICAgICAgIGZvdW5kUmVxdWlyZW1lbnQgPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIElmIGEgcmVxdWlyZW1lbnQgaXNuJ3QgZm91bmQgYWRkIHRoYXQgYSBsaXN0XHJcbiAgICAgICAgaWYgKCFmb3VuZFJlcXVpcmVtZW50KSB7XHJcbiAgICAgICAgICBtaXNzaW5nUmVxdWlyZW1lbnRzLnB1c2gocmVxdWlyZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyBPbmNlIHdlIGNoZWNrIHRvIHNlZSBpZiB0aGUgcGxheWVyJ3MgbWlzc2luZyBhbnkgaXRlbXMsXHJcbiAgICAvLyBwYXJzZSB0aGUgaW5wdXQgZm9yIG1hdGNoaW5nIGtleXdvcmRzIHRvIHRoZSBwcm9tcHRcclxuICAgIHRoaXMua2V5d29yZHMuZm9yRWFjaChmdW5jdGlvbiAoa2V5d29yZCkge1xyXG4gICAgICBpZiAobWVzc2FnZS5pbmNsdWRlcyhrZXl3b3JkLnRvTG93ZXJDYXNlKCkpKSB7XHJcbiAgICAgICAgZm91bmRLZXl3b3JkID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyBJZiBhbnkga2V5d29yZHMgaGF2ZSBiZWVuIG1hdGNoZWQgZnJvbSB0aGUgdXNlciBpbnB1dFxyXG4gICAgaWYgKGZvdW5kS2V5d29yZCkge1xyXG4gICAgICAvLyBJZiB0aGVyZSBhcmUgYW55IG1pc3NpbmcgaXRlbSByZXF1aXJlbWVudHNcclxuICAgICAgaWYgKG1pc3NpbmdSZXF1aXJlbWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIC8vIFByb21wdCBmYWlsczsgcmV0dXJuIG1pc3NpbmcgaXRlbXMgYW5kIGZhaWxUZXh0XHJcbiAgICAgICAgcmV0dXJuIHsnZmFpbCc6IHtcclxuICAgICAgICAgICdtaXNzaW5nJzogbWlzc2luZ1JlcXVpcmVtZW50cyxcclxuICAgICAgICAgICdmYWlsVGV4dCc6IHRoaXMucmVzdWx0cy5mYWlsVGV4dH1cclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIC8vIFByb21wdCBzdWNjZWVkczsgcmV0dXJuIHJlc3VsdHMgb2YgdGhlIHByb21wdFxyXG4gICAgICByZXR1cm4geydzdWNjZXNzJzogdGhpcy5yZXN1bHRzfTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9